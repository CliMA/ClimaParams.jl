<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>TOML file interface · ClimaParams.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaParams.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>TOML file interface</a><ul class="internal"><li><a class="tocitem" href="#Parameter-style-guide"><span>Parameter style-guide</span></a></li><li><a class="tocitem" href="#File-and-parameter-interaction-with-CliMA"><span>File and parameter interaction with CliMA</span></a></li></ul></li><li><a class="tocitem" href="../param_retrieval/">Parameter retrieval</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>TOML file interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>TOML file interface</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaParams.jl/blob/main/docs/src/toml.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-TOML-parameter-file-interface"><a class="docs-heading-anchor" href="#The-TOML-parameter-file-interface">The TOML parameter file interface</a><a id="The-TOML-parameter-file-interface-1"></a><a class="docs-heading-anchor-permalink" href="#The-TOML-parameter-file-interface" title="Permalink"></a></h1><p>The complete user interface consists of two files in <code>TOML</code> format</p><ol><li>A user-defined experiment file - in the local experiment directory</li><li>A defaults file - in <code>src/</code> directory of <code>ClimaParams.jl</code></li></ol><h2 id="Parameter-style-guide"><a class="docs-heading-anchor" href="#Parameter-style-guide">Parameter style-guide</a><a id="Parameter-style-guide-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-style-guide" title="Permalink"></a></h2><p>A parameter is determined by its unique name. It has possible attributes</p><ol><li><code>value</code></li><li><code>type</code></li><li><code>description</code></li><li><code>prior</code></li><li><code>tag</code></li><li><code>transformation</code></li></ol><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>Currently we support types: <code>float</code>, <code>integer</code>, <code>string</code> and <code>bool</code>. Array types are designated by the same <code>type</code> as singleton types.</p></div></div><h3 id="Minimal-parameter-requirement-to-run-in-CliMA"><a class="docs-heading-anchor" href="#Minimal-parameter-requirement-to-run-in-CliMA">Minimal parameter requirement to run in CliMA</a><a id="Minimal-parameter-requirement-to-run-in-CliMA-1"></a><a class="docs-heading-anchor-permalink" href="#Minimal-parameter-requirement-to-run-in-CliMA" title="Permalink"></a></h3><pre><code class="language-TOML hljs">[molar_mass_dry_air]
value = 0.03
type = &quot;float&quot;</code></pre><h3 id="A-more-informative-parameter-(e.g.-found-in-the-defaults-file)"><a class="docs-heading-anchor" href="#A-more-informative-parameter-(e.g.-found-in-the-defaults-file)">A more informative parameter (e.g. found in the defaults file)</a><a id="A-more-informative-parameter-(e.g.-found-in-the-defaults-file)-1"></a><a class="docs-heading-anchor-permalink" href="#A-more-informative-parameter-(e.g.-found-in-the-defaults-file)" title="Permalink"></a></h3><pre><code class="language-TOML hljs">[molar_mass_dry_air]
value = 0.02897
type = &quot;float&quot;
description = &quot;Molecular weight dry air (kg/mol)&quot;</code></pre><h3 id="Properly-tagged-parameter"><a class="docs-heading-anchor" href="#Properly-tagged-parameter">Properly tagged parameter</a><a id="Properly-tagged-parameter-1"></a><a class="docs-heading-anchor-permalink" href="#Properly-tagged-parameter" title="Permalink"></a></h3><p>To add a tag to a parameter, set the <code>tag</code> field with a list of tags. Tags are an optional convenience and do not create a namespace. All parameter names must be unique.</p><p>As an initial convention, parameters will be tagged with the component(s) in which they are used. This convention will be changed as we see how packages use tags.</p><pre><code class="language-TOML hljs">[prandtl_number_0_grachev]
value = 0.98
type = &quot;float&quot;
description = &quot;Pr_0 for Grachev universal functions. From Grachev et al, 2007. DOI: 10.1007/s10546-007-9177-6&quot;
tag = [&quot;SurfaceFluxes&quot;]</code></pre><p>If this convention is followed, to obtain the parameters used to build tagged by &quot;surfacefluxes&quot;, one could call for example:</p><pre><code class="language-julia hljs">surfacefluxes_params = get_tagged_parameter_values(toml_dict, &quot;surfacefluxes&quot;)</code></pre><p>To match tags, punctuation and capitalization is removed. For more information, see <a href="../API/#ClimaParams.fuzzy_match"><code>fuzzy_match</code></a>.</p><h3 id="A-more-complex-parameter-for-calibration"><a class="docs-heading-anchor" href="#A-more-complex-parameter-for-calibration">A more complex parameter for calibration</a><a id="A-more-complex-parameter-for-calibration-1"></a><a class="docs-heading-anchor-permalink" href="#A-more-complex-parameter-for-calibration" title="Permalink"></a></h3><pre><code class="language-TOML hljs">[neural_net_entrainment]
value = [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]
type = &quot;float&quot;
description = &quot;NN weights to represent the non-dimensional entrainment function&quot;
prior = &quot;MvNormal(0,I)&quot;</code></pre><h3 id="Interaction-of-the-files"><a class="docs-heading-anchor" href="#Interaction-of-the-files">Interaction of the files</a><a id="Interaction-of-the-files-1"></a><a class="docs-heading-anchor-permalink" href="#Interaction-of-the-files" title="Permalink"></a></h3><p>On read an experiment file, the default file is also read and any duplicate parameter attributes are overwritten e.g. If the minimal example above was loaded from an experiment file, and the informative example above was in the defaults file, then the loaded parameter would look as follows:</p><pre><code class="language-TOML hljs">[molar_mass_dry_air]
value = 0.03
type = &quot;float&quot;
description = &quot;Molecular weight dry air (kg/mol)&quot;</code></pre><p>Here, the <code>value</code> field has been overwritten by the experiment value.</p><h2 id="File-and-parameter-interaction-with-CliMA"><a class="docs-heading-anchor" href="#File-and-parameter-interaction-with-CliMA">File and parameter interaction with CliMA</a><a id="File-and-parameter-interaction-with-CliMA-1"></a><a class="docs-heading-anchor-permalink" href="#File-and-parameter-interaction-with-CliMA" title="Permalink"></a></h2><p><code>ClimaParams.jl</code> provides several methods to parse, merge, and log parameter information.</p><h3 id="Loading-from-file"><a class="docs-heading-anchor" href="#Loading-from-file">Loading from file</a><a id="Loading-from-file-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-from-file" title="Permalink"></a></h3><p>We provide the following methods to load parameters from file</p><pre><code class="language-julia hljs">create_toml_dict(Float64; override_filepath, default_filepath)
create_toml_dict(Float64; override_filepath)</code></pre><p>The <code>Float64</code> (or <code>Float32</code>) defines the requested precision of the returned parameters.</p><p>Typical usage involves passing the local parameter file</p><pre><code class="language-julia hljs">import ClimaParams
local_experiment_file = joinpath(@__DIR__,&quot;local_exp_parameters.toml&quot;)
toml_dict = ClimaParams.create_toml_dict(; override_file = local_experiment_file)</code></pre><p>If no file is passed it will use only the defaults from <code>ClimaParams.jl</code> (causing errors if required parameters are not within this list).</p><p>You can also pass Julia <code>Dicts</code> directly to <code>override_filepath</code> and <code>default_filepath</code>.</p><p>If you want to use more than two TOML files, you can merge them with <a href="../API/#ClimaParams.merge_toml_files"><code>merge_toml_files(filepaths...)</code></a>. By default, duplicate TOML entries are not allowed, but this can be changed by setting <code>override = true</code>.</p><p>The parameter dict is then used to build the codebase (see Parameter Retrieval for usage and examples).</p><h3 id="Logging-parameters"><a class="docs-heading-anchor" href="#Logging-parameters">Logging parameters</a><a id="Logging-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Logging-parameters" title="Permalink"></a></h3><p>Once the CliMA components are built, it is important to log the parameters. We provide the following method</p><pre><code class="language-julia hljs">log_parameter_information(toml_dict, filepath; strict=false)</code></pre><p>Typical usage will be after building components and before running</p><pre><code class="language-julia hljs">import Thermodynamics
therm_params = Thermodynamics.ThermodynamicsParameters(toml_dict)
#... build(thermodynamics model,therm_params)

log_file = joinpath(@__DIR__,&quot;parameter_log.toml&quot;)
ClimaParams.log_parameter_information(toml_dict,log_file)

# ... run(thermodynamics_model)</code></pre><p>This function performs two tasks</p><ol><li>It writes a parameter log file to <code>log_file</code>.</li><li>It performs parameter sanity checks.</li></ol><p>Continuing our previous example, imagine <code>molar_mass_dry_air</code> was extracted in <code>ThermodynamicsParameters</code>. Then the log file will contain:</p><pre><code class="language-TOML hljs">[molar_mass_dry_air]
value = 0.03
type = &quot;float&quot;
description = &quot;Molecular weight dry air (kg/mol)&quot;
used_in = [&quot;Thermodynamics&quot;]</code></pre><p>The additional attribute <code>used_in</code> displays every CliMA component that used this parameter.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Log files are written in TOML format, and can be read back into the model.</p></div></div><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>It is assumed that all parameters in the local experiment file should be used, if not a warning is displayed when calling <code>log_parameter_information</code>. This is upgraded to an error exception by changing <code>strict</code>.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../param_retrieval/">Parameter retrieval »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 16 May 2024 19:09">Thursday 16 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
